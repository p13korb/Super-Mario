<!DOCTYPE HTML>
<html>
<head>
<title>Super-Mario</title>
<meta charset="utf-8">
<style>
body {
	margin: 0;
	padding: 0;
	background-color: #000;
}
</style>
<script src="menu.js"></script>
<script src="stage1.js"></script>
<script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
</head>
<body>
	<script type="text/javascript">
		var game = new Phaser.Game(1030, 480, Phaser.CANVAS, '', this, false, false);

		function preload() {

			//this.load.baseURL = 'https://p16korb.github.io/Super-Mario/';
			//this.load.crossOrigin = 'anonymous';

		}

		game.state.add('stage1', stage1);
		//game.state.add('stage2', stage2);
		game.state.add('menu', menu);
		game.state.start('menu');

		var back;
		var score = 0;
		var lives = 2;
		var mushflag = false;

		var text;
		var game_overtext; 	 
		var badmushflag = false;
		var endtext;

		function coinOverlap(player, coin) {
			mpim = game.add.audio('mpim');
			coin.kill();
			mpim.play();
			score++; 
			text.text = 'SCORE:' +score;
		}

		function end(){

			back.stop();
			
			var style5 = { font: "bold 80px Roman", fill: "#4bb84b", boundsAlignH: "center", boundsAlignV: "middle" };
			var style = { font: "bold 70px Arial", fill: "#FFA500", boundsAlignH: "center", boundsAlignV: "middle" };
			endtext = game.add.text(120, 150, "CONGRATULATIONS", style5);
			text = game.add.text(360, 250, "SCORE:  "+score, style);
			endtext.fixedToCamera=true; 
			text.fixedToCamera=true;
			player.body.enable = false;
			player.animations.stop();

			game.time.events.add(Phaser.Timer.SECOND * 3, function() {

			game.stage.backgroundColor = '#000000';	
			lives = 2
			score = 0;
			game.state.start('menu');
				});

		}

		function goombaOverlap(player, goomba) {
			if (player.body.touching.down) {
				goomba.animations.stop();
				goomba.frame = 2;
				goomba.body.enable = false;
				player.body.velocity.y = -80;
				game.time.events.add(Phaser.Timer.SECOND, function() {
					goomba.kill();
				});
			} else {
				player.frame = 6;
				player.body.enable = false;
				player.animations.stop();
				if (lives>=1) {
					lives--;
					score = 0;
					die();
				}
				else{
				
					dying();
			}
		}
	}

	function mush2collide(player, mush2){

			if (player.body.touching.up){

				mush2.body.enable = false;
				end();

			}else if (player.body.touching.right){

				mush2.body.enable = false;
				end();

			}else if (player.body.touching.left){
				
				mush2.body.enable = false;
				end();
			}else

				mush2.body.enable = false;
				end();

		}

	function heartCollide1(player, heart){

			heart.kill();
			heart.body.enable = false;
			player.reset(1500,-420);
		
		}


		function xelOverlap(player, xel) {
			if (player.body.touching.down) {
				xel.animations.stop();
				xel.body.enable = false;
				player.body.velocity.y = -80;
				game.time.events.add(Phaser.Timer.SECOND, function() {
					xel.kill();
				});
			} else {
				player.frame = 6;
				player.body.enable = false;
				player.animations.stop();
				if (lives>=1) {
					lives--;
					score = 0;
					die();
				}
				else{
				
					dying();
			}
		}
	}

		function die(){

			dies = game.add.audio('dies');
			lives--;
			score = 0;
			back.stop();
			dies.play();
			game.state.start(game.state.current);

		}

		function mushOverlap(player,mush){ // Manitari
			
			
			if (mushflag == false){

				
				mu=game.add.audio('mush');
				mu.play();
				mush.kill();
				mush.body.enable = false;
			}
			mushflag = true;
			

			lives++;
			livestext.text = 'LIVES: ' +lives;

		}

	function dying(){
		
			game_over = game.add.audio('game_over');
			var style5 = { font: "bold 50px Arial", fill: "#000000", boundsAlignH: "center", boundsAlignV: "middle" };
			game_overtext = game.add.text(280, 150, "GAME OVER", style5);
			var style = { font: "bold 70px Arial", fill: "#FFA500", boundsAlignH: "center", boundsAlignV: "middle" };
			text = game.add.text(360, 250, "SCORE:  "+score, style);
			text.fixedToCamera = true;
			game_overtext.fixedToCamera=true; 
			game.time.events.add(Phaser.Timer.SECOND * 3, function() {

			game.stopped = true;
			back.stop();
			game.stage.backgroundColor = '#000000';
			lives = 2
			score = 0;
			game.state.start('menu');
				});

		}		
	</script>
</body>
</html>
